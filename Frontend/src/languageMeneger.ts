const en = {
    "signin": {
        "register-b": "Register",
        "email-or-nickname-i": "Email or Nickname",
        "passwor-i": "Password",
        "login-b": "Login"
    },
    "signin-success": "Login successful! Redirecting...",
    "signin-errors": {
        "required": {
            "email": "Email or Nickname is required",
            "password": "Password is required"
        },
        "INVALID_CREDENTIALS": "Invalid email/nickname or password",
        "serverError": "Server error, please try again later"
    },
    "register": {
        "title": "Register",
        "signin-b": "Sign In",
        "name": "Enter Name",
        "surname": "Enter Surname",
        "username": "Enter Username",
        "email": "Enter Email",
        "password": "Enter Password",
        "confirmPassword": "Confirm Password",
        "register": "Register"
    },
    "register-success": "Registration successful! Please log in.",
    "register-errors": {
        "required": {
            "name": "Name is required",
            "surname": "Surname is required",
            "username": "Username is required",
            "email": "Email is required",
            "password": "Password is required",
            "confirmPassword": "Confirm Password is required"
        },
        "minlength": {
            "name": "Name must be at least 3 characters",
            "surname": "Surname must be at least 3 characters",
            "username": "Username must be at least 3 characters",
            "password": "Password must be at least 6 characters",
            "confirmPassword": "Confirm Password must be at least 6 characters"
        },
        "maxlength": {
            "username": "Username must be at most 20 characters",
            "password": "Password must be at most 20 characters"
        },
        "invalidCharacters": {
            "username": "Invalid username characters (a-zA-Z0-9_.)",
            "email": "Invalid email format"
        },
        "passwordMismatch": "Passwords do not match",
        "exists": {
            "username": "This username is already taken",
            "email": "This email is already registered"
        },
        "serverError": "Server error, please try again later"
    },
    "home": {
        "play-b": "Play Now",
        "settings-b": "Settings",
        "profile-b": "Profile",
        "tournament-b": "Tournament",
        "logout-b": "Logout"
    },
    "settings": {
        "title": "Settings",
        "ball-color": "Ball Color",
        "language-select": "Language Selection",
        "save-button": "Save Settings"
    },
    "profile": {
        "title": "Profile Settings",
        "username": "Username"
    },
    "profile-settings": {
        "username": "Username",
        "username-placeholder": "New Username",
        "email": "Email",
        "email-placeholder": "New Email",
        "password": "Password",
        "password-placeholder": "New Password",
        "old-Password": "Old Password",
        "old-password-placeholder": "Old Password",
        "update": "Update"
    },
    "tournament-first-page": {
        "join-title": "Join Tournament",
        "join-placeholder": "Enter Tournament ID",
        "join-button": "Join Tournament",
        "create-title": "Create Tournament",
        "create-placeholder": "Enter Tournament Name",
        "create-button": "Create Tournament",
        "m-title-for-showjoin": "Create Tournament",
        "m-title-for-showcreate": "Join Tournament",
        "m-join-button": "--->",
        "m-create-button": "<---"
    },
    "tournament-second-page": {
        "exit": "Exit Tournament",
        "tournament-id": "Tournament ID",
        "tournament-name": "Tournament Name",
        "tournament-creater": "Tournament Creator",
        "tournament-total-players": "Total Players",
        "tournament-joined-players": "Joined Players",
        "play": "Play"
    },
    "game": {
        "loading": "Game Page Loading...",
        "vs-compiter-b": "Play vs Computer",
        "vs-compiter-difficulty-b-easy": "Easy",
        "vs-compiter-difficulty-b-medium": "Medium",
        "vs-compiter-difficulty-b-hard": "Hard",
        "find-reval-b": "Find Opponent",
        "find-reval-waiting": "Waiting for Opponent...",
        "local-game": "Local Game",
        "tournament": "Tournament",
        "stratt-game": "Start Game",
        "continue-game": "Continue Game",
        "new-game": "Start New Game",
        "sets": "SETS!"
    }
}

const tr  = {
	"singin": {
		"register-b": "Kayıt Ol",
		"email-or-nickname-i": "E-posta",
		"passwor-i": "Şifre",
		"login-b": "Giriş Yap"
	},
	"singin-success": "Giriş başarılı! Yönlendiriliyorsunuz...",
	"singin-errors": {
		"required": {
			"email": "E-posta veya Nickname gerekli",
			"password": "Şifre gerekli"
		},
		"INVALID_CREDENTIALS": "Geçersiz e-posta/nickname veya şifre",
		"serverError": "Sunucu hatası, lütfen daha sonra tekrar deneyin"
	},
	"register": {
		"title": "Kayıt Ol",
		"singin-b": "Giriş Yap",
		"name": "İsim Giriniz",
		"surname": "Soyisim Giriniz",
		"username": "Kullanıcı Adı Giriniz",
		"email": "E-posta Giriniz",
		"password": "Şifre Giriniz",
		"confirmPassword": "Şifreyi Tekrar Giriniz",
		"register": "Kayıt Ol"
	},
	"register-success": "Kayıt başarılı! Lütfen giriş yapın.",
	"register-errors": {
		"required": {
			"name": "İsim gerekli",
			"surname": "Soyisim gerekli",
			"username": "Kullanıcı adı gerekli",
			"email": "E-posta gerekli",
			"password": "Şifre gerekli",
			"confirmPassword": "Şifreyi onayla gerekli"
		},
		"minlength": {
			"name": "İsim en az 3 karakter olmalıdır",
			"surname": "Soyisim en az 3 karakter olmalıdır",
			"username": "Kullanıcı adı en az 3 karakter olmalıdır",
			"password": "Şifre en az 6 karakter olmalıdır",
			"confirmPassword": "Şifreyi onayla en az 6 karakter olmalıdır"
		},
		"maxlength": {
			"username": "Kullanıcı adı en fazla 20 karakter olmalıdır",
			"password": "Şifre en fazla 20 karakter olmalıdır"
		},
		"invalidCharacters": {
			"username": "Geçersiz username karakterleri (a-zA-Z0-9_.)",
			"email": "Geçersiz e-posta formatı"
		},
		"passwordMismatch": "Şifreler eşleşmiyor",
		"exists": {
			"username": "Bu kullanıcı adı zaten alınmış",
			"email": "Bu e-posta zaten kayıtlı"
		},
		"serverError": "Sunucu hatası, lütfen daha sonra tekrar deneyin"
	},

	"home":{
		"play-b": "Şimdi Oyna",
		"settings-b": "Ayarlar",
		"profile-b": "Profil",
		"tournament-b": "Turnuva",
		"logout-b": "Çıkış Yap"
	},
	"settings": {
		"title": "Ayarlar",
		"ball-color": "Top Rengi",
		"language-select": "Dil Seçimi",
		"save-button": "Ayarları Kaydet"
	},
	"profile": {
		"title": "Profil Ayarları",
		"username": "Kullanıcı Adı"
	},
	"profile-settings": {
		"username": "Kullanıcı Adı",
		"username-placeholder": "Yeni Kullanıcı Adı",
		"email": "E-posta",
		"email-placeholder": "Yeni E-posta",
		"password": "Şifre",
		"password-placeholder": "Yeni Şifre",
		"old-Password": "Eski Şifre",
		"old-password-placeholder": "Eski Şifre",
		"update": "Güncelle"
	},
	"tournament-first-page": {
		"join-title": "Turnuvaya Katıl",
		"join-placeholder": "Turnuva ID Giriniz",
		"join-button": "Turnuvaya Katıl",
		"create-title": "Turnuva Oluştur",
		"create-placeholder": "Turnuva Adı Giriniz",
		"create-button": "Turnuva Oluştur",
		"m-title-for-showjoin": "Turnuva Oluştur",
		"m-title-for-showcreate": "Turnuvaya Katıl",
		"m-join-button": "--->",
		"m-create-button": "<---"
	},
	"tournament-second-page":{
		"exit": "Turnuvadan Çık",
		"tournament-id": "Turnuva ID",
		"tournament-name": "Turnuva Adı",
		"tournament-creater": "Turnuva Oluşturan",
		"tournament-total-players": "Toplam Oyuncu",
		"tournament-joined-players": "Katılan Oyuncular",
		"play": "Oyna"
	},
	"game":{
		"loading": "Oyun Sayfası Yükleniyor...",

		"vs-compiter-b":"Bilgisayara Karşı Oyna",
		"vs-compiter-difficulty-b-easy": "Kolay",
		"vs-compiter-difficulty-b-medium": "Orta",
		"vs-compiter-difficulty-b-hard": "Zor",

		"find-reval-b": "Rakip Bul",
		"find-reval-waiting": "Rakip Bekleniyor...",
		
		"local-game": "Yerel Oyun",
		
		"tournament": "Turnuva",

		"stratt-game": "Oyunu Başlat",
		"continue-game": "Oyuna Devam Et",
		"new-game": "Yeni Oyun Başlat",
		"sets": "SETLER",
	}
}


const fr = {
    "singin": {
        "register-b": "S'inscrire",
        "email-or-nickname-i": "E-mail ou Pseudo",
        "passwor-i": "Mot de passe",
        "login-b": "Se connecter"
    },
    "singin-success": "Connexion réussie ! Redirection...",
    "singin-errors": {
        "required": {
            "email": "E-mail ou Pseudo requis",
            "password": "Mot de passe requis"
        },
        "INVALID_CREDENTIALS": "E-mail/pseudo ou mot de passe invalide",
        "serverError": "Erreur serveur, veuillez réessayer plus tard"
    },
    "register": {
        "title": "S'inscrire",
        "singin-b": "Se connecter",
        "name": "Entrez votre nom",
        "surname": "Entrez votre prénom",
        "username": "Entrez votre nom d'utilisateur",
        "email": "Entrez votre e-mail",
        "password": "Entrez votre mot de passe",
        "confirmPassword": "Confirmez le mot de passe",
        "register": "S'inscrire"
    },
    "register-success": "Inscription réussie ! Veuillez vous connecter.",
    "register-errors": {
        "required": {
            "name": "Le nom est requis",
            "surname": "Le prénom est requis",
            "username": "Le nom d'utilisateur est requis",
            "email": "L'e-mail est requis",
            "password": "Le mot de passe est requis",
            "confirmPassword": "La confirmation du mot de passe est requise"
        },
        "minlength": {
            "name": "Le nom doit contenir au moins 3 caractères",
            "surname": "Le prénom doit contenir au moins 3 caractères",
            "username": "Le nom d'utilisateur doit contenir au moins 3 caractères",
            "password": "Le mot de passe doit contenir au moins 6 caractères",
            "confirmPassword": "La confirmation du mot de passe doit contenir au moins 6 caractères"
        },
        "maxlength": {
            "username": "Le nom d'utilisateur doit contenir au plus 20 caractères",
            "password": "Le mot de passe doit contenir au plus 20 caractères"
        },
        "invalidCharacters": {
            "username": "Caractères invalides pour le nom d'utilisateur (a-zA-Z0-9_.)",
            "email": "Format d'e-mail invalide"
        },
        "passwordMismatch": "Les mots de passe ne correspondent pas",
        "exists": {
            "username": "Ce nom d'utilisateur est déjà pris",
            "email": "Cet e-mail est déjà enregistré"
        },
        "serverError": "Erreur serveur, veuillez réessayer plus tard"
    },
    "home": {
        "play-b": "Jouer maintenant",
        "settings-b": "Paramètres",
        "profile-b": "Profil",
        "tournament-b": "Tournoi",
        "logout-b": "Déconnexion"
    },
    "settings": {
        "title": "Paramètres",
        "ball-color": "Couleur de la balle",
        "language-select": "Sélection de la langue",
        "save-button": "Enregistrer les paramètres"
    },
    "profile": {
        "title": "Paramètres de profil",
        "username": "Nom d'utilisateur"
    },
    "profile-settings": {
        "username": "Nom d'utilisateur",
        "username-placeholder": "Nouveau nom d'utilisateur",
        "email": "E-mail",
        "email-placeholder": "Nouvel e-mail",
        "password": "Mot de passe",
        "password-placeholder": "Nouveau mot de passe",
        "old-Password": "Ancien mot de passe",
        "old-password-placeholder": "Ancien mot de passe",
        "update": "Mettre à jour"
    },
    "tournament-first-page": {
        "join-title": "Rejoindre un tournoi",
        "join-placeholder": "Entrez l'ID du tournoi",
        "join-button": "Rejoindre le tournoi",
        "create-title": "Créer un tournoi",
        "create-placeholder": "Entrez le nom du tournoi",
        "create-button": "Créer un tournoi",
        "m-title-for-showjoin": "Créer un tournoi",
        "m-title-for-showcreate": "Rejoindre un tournoi",
        "m-join-button": "--->",
        "m-create-button": "<---"
    },
    "tournament-second-page": {
        "exit": "Quitter le tournoi",
        "tournament-id": "ID du tournoi",
        "tournament-name": "Nom du tournoi",
        "tournament-creater": "Créateur du tournoi",
        "tournament-total-players": "Joueurs totaux",
        "tournament-joined-players": "Joueurs inscrits",
        "play": "Jouer"
    },
    "game": {
        "loading": "Chargement de la page de jeu...",
        "vs-compiter-b": "Jouer contre l'ordinateur",
        "vs-compiter-difficulty-b-easy": "Facile",
        "vs-compiter-difficulty-b-medium": "Moyen",
        "vs-compiter-difficulty-b-hard": "Difficile",
        "find-reval-b": "Trouver un adversaire",
        "find-reval-waiting": "En attente d'un adversaire...",
        "local-game": "Jeu local",
        "tournament": "Tournoi",
        "stratt-game": "Démarrer le jeu",
        "continue-game": "Continuer le jeu",
        "new-game": "Démarrer une nouvelle partie",
        "sets": "MANCHES !"
    }
}


type TranslationObject = {
	[key: string]: string | TranslationObject;
}

type LanguageChangeListener = (language: string) => void;

export class LanguageManager
{
	private static instance: LanguageManager;
	private language: string;
	private languageData: Map<string, TranslationObject>;
	private listeners: LanguageChangeListener[];
	private loading: boolean;
	private loadPromise: Promise<void> | null;
	private languageChoises: string[];

	private constructor() {
		this.language = localStorage.getItem('language') ||'tr'; // Default language
		this.languageChoises = ['tr', 'en', 'fr']; // Available languages
		this.languageData = new Map();
		this.listeners = [];
		this.loading = false;
		this.loadPromise = null;
		
		console.log('languageManager instance created');
		localStorage.setItem('language', this.language); // Store the default language in local storage
		this.loadLanguageData(this.language);
	}

	public static getInstance(): LanguageManager {
		if (!LanguageManager.instance) { // sadece ilk defa çağırıldığında instance oluştur , tek bir nesne geriye kalan her yerde kullanılacak
			LanguageManager.instance = new LanguageManager();
		}
		return LanguageManager.instance;
	}

	/*-----Burada yapmamız gereken eklediğimiz eventleri listeye almak ve her birini sonrasında çağırmak---*/
	public addLanguageChangeListener(listener: LanguageChangeListener): void {
		this.listeners.push(listener);
	}

	public removeLanguageChangeListener(listener: LanguageChangeListener): void {
		const index = this.listeners.indexOf(listener);
		if (index !== -1) {
			this.listeners.splice(index, 1);
		}
	}

	public async setLanguage(language: string): Promise<void> {
		if (this.language === language) return; // No change in language

		this.language = language;
		localStorage.setItem('language', language); // Store the selected language in local storage

		// console.log('3 saniyede');
		// 3 saniye bekle
		// await new Promise(resolve => setTimeout(resolve, 3000));
		

		await this.loadLanguageData(language); // Load the new language data
		// console.log('dil değişimi bildiriliyor');
		this.notifyLanguageChange(); // Notify all listeners about the language change
		// console.log('notify bitti');
		// await new Promise(resolve => setTimeout(resolve, 3000));
	}

	//! notiy -> bildirmek
	private notifyLanguageChange(): void {
		// console.log('notifyLanguageChange çalıştı');
		// console.log(this.listeners.length);
		// let i = 0;
		for (const listener of this.listeners) {
			listener(this.language);
			// i++;
		}
		console.log(`notifyLanguageChange: ${this.listeners.length} dinleyiciye bildirim gönderildi.`);
		// console.log('notifyLanguageChange tamamlandı');
		// console.log('i: ' + i);
	}

	private async loadLanguageData(language: string) {
		if (this.loading) {
			if (this.loadPromise) {
				await this.loadPromise;
			}
			return;
		}

		this.loading = true;
		this.loadPromise = new Promise(async (resolve) => {
			if (language === 'tr')
				this.languageData.set(language, tr); // Set default language data
			else if (language === 'en')
				this.languageData.set(language, en); // Set default language data
			else
				this.languageData.set(language, fr); // Set default language data
			this.loading = false;
			resolve();
			//! aşağıdaki istek yerine şimidlik yukarıdaki nesneleri çekip kullanalım
			// try {
			// 	const response = await fetch(`./languages/${language}.json`);
			// 	if (!response.ok) {
			// 		throw new Error(`Error fetching language data: ${response.statusText}`);
			// 	}
			// 	const data = await response.json();
			// 	this.languageData.set(language, data);
			// 	this.notifyLanguageChange();
			// } catch (error) {
			// 	console.error(error);
			// } finally {
			// 	this.loading = false;
			// 	this.loadPromise = null;
			// 	resolve();
			// }
		});
		await this.loadPromise;
		// console.log('dil ayarlandi, bir sonraki dinleyicilere yönlendirme yapılıyor');
		// await new Promise(resolve => setTimeout(resolve, 3000));
		// ! sayfa içerisinde eventlerin çalışmamasının nedeni aşağıdaki satırın hem burada hem de 
		// ! bunu fonsiyonu çağıran fonsiyonun hemen altında kullanılması
		// this.notifyLanguageChange();
	}

	public getLanguage(): string {
		return this.language;
	}

	public getLanguageChoises(): string[] {
		return this.languageChoises;
	}

	public getLang(key: string): string {
		if (this.loading) {
			return "Loading..."; // Return a loading message if data is still being fetched
		}
		const data = this.languageData.get(this.language);
		if (!data) {
			return key; // Return the key itself if language data is not available
		}

		const keys = key.split('.');
		let currentData: any = data;

		for (let i = 0; i < keys.length; i++) {
			const k = keys[i];

			if (currentData[k] === undefined) {
				return key; // Return the key itself if the translation is not found
			}

			currentData = currentData[k];
			
			if (i === keys.length - 1 && typeof currentData === 'string') {
				return currentData; // Return the translation if it's a string
			}
		}
		return key; // Return the key itself if the translation is not found
	}

	public async waitForLoad(): Promise<void> {
		if (this.loadPromise) {
			await this.loadPromise;
		}

		return Promise.resolve();
	}
}

export const exmp = LanguageManager.getInstance();